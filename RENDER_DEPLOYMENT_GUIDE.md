# üöÄ Render Deployment Guide - Telegram Drug Monitor

## üìã **Pre-Deployment Checklist**

Before deploying to Render, ensure you have:

### ‚úÖ **Requirements**
- [x] **GitHub/GitLab account** for code repository
- [x] **Render account** (free tier available)
- [x] **MongoDB Atlas account** (existing connection string in .env)
- [x] **Telegram API credentials** from [my.telegram.org](https://my.telegram.org)

---

## üîÑ **Step 1: Prepare Your Code Repository**

### **Option A: Create New GitHub Repository**

1. **Create Repository on GitHub:**
   - Go to [github.com](https://github.com)
   - Click "New repository"
   - Name: `telegram-drug-monitor`
   - Set to Public or Private
   - Don't initialize with README (we have our own)

2. **Push Your Code:**
   ```bash
   # In your project directory
   git init
   git add .
   git commit -m "Initial commit - Telegram Drug Monitor for Render deployment"
   git branch -M main
   git remote add origin https://github.com/YOUR_USERNAME/telegram-drug-monitor.git
   git push -u origin main
   ```

### **Option B: Use Existing Repository**
If you already have a repository, just push the latest changes:
```bash
git add .
git commit -m "Updated for Render deployment"
git push origin main
```

---

## üåê **Step 2: Deploy on Render**

### **1. Connect GitHub to Render**

1. **Go to Render Dashboard:**
   - Visit [render.com](https://render.com)
   - Sign up/login with your GitHub account
   - Click "New +" ‚Üí "Web Service"

2. **Connect Repository:**
   - Select "Connect a repository"
   - Choose your `telegram-drug-monitor` repository
   - Click "Connect"

### **2. Configure Deployment Settings**

#### **Basic Configuration:**
- **Name:** `telegram-drug-monitor`
- **Region:** Choose closest to your location
- **Branch:** `main`
- **Runtime:** `Python 3`

#### **Build & Deploy Settings:**
- **Build Command:** `pip install --upgrade pip && pip install -r requirements.txt`
- **Start Command:** `gunicorn --bind 0.0.0.0:$PORT --workers 2 --timeout 120 wsgi:application`

### **3. Set Environment Variables**

In Render dashboard, add these environment variables:

#### **Required Variables:**
```bash
MONGODB_URI = mongodb+srv://adityapatel1335_db_user:creatusEST123@cluster0.woydxwp.mongodb.net/?retryWrites=true&w=majority&appName=Cluster0

SECRET_KEY = your-super-secure-random-key-change-this-for-production

DATABASE_NAME = telegram_drug_monitor

FLASK_ENV = production

PYTHONPATH = .
```

#### **Auto-Generated by Render:**
- `PORT` (automatically set)

### **4. Advanced Settings:**
- **Health Check Path:** `/health`
- **Auto Deploy:** `Yes` (deploys on git push)

---

## üîß **Step 3: Configure for Production**

### **Security Settings:**
1. **Generate Strong Secret Key:**
   ```python
   import secrets
   print(secrets.token_urlsafe(32))
   ```
   Use this output as your `SECRET_KEY` in Render

2. **MongoDB Atlas Security:**
   - Ensure your MongoDB Atlas cluster allows connections from `0.0.0.0/0` (all IPs)
   - Or add Render's IP ranges if available

---

## üöÄ **Step 4: Deploy and Verify**

### **1. Start Deployment**
- Click "Create Web Service" in Render
- Render will automatically start building and deploying
- Watch the build logs for any errors

### **2. Monitor Build Process**
The build process will:
1. ‚úÖ Clone your repository
2. ‚úÖ Install Python dependencies
3. ‚úÖ Download AI models (this takes 5-10 minutes)
4. ‚úÖ Start the application with Gunicorn

### **3. Access Your Application**
- Render will provide a URL like: `https://telegram-drug-monitor-xxxx.onrender.com`
- Click on the URL to access your deployed application

---

## üß™ **Step 5: Test Deployment**

### **1. Basic Functionality Test:**
1. **Open your Render URL**
2. **Register a new account:**
   - Username: `test_user`
   - Password: `test123456`
   - API ID: Your real Telegram API ID
   - API Hash: Your real Telegram API Hash

3. **Link Telegram Account:**
   - Enter your phone number
   - Receive OTP via Telegram
   - Verify and link account

4. **Test Channel Monitoring:**
   - Add a test channel: `https://t.me/telegram`
   - Click "Monitor" to analyze messages
   - View results and verify detection works

### **2. Health Check Verification:**
```bash
curl https://your-app-name.onrender.com/health
```
Should return:
```json
{
  "status": "healthy",
  "timestamp": "2024-01-01T00:00:00.000000",
  "service": "Telegram Drug Monitor",
  "version": "1.0.0"
}
```

---

## üîß **Troubleshooting Common Issues**

### **Build Fails - Dependencies**
**Problem:** Build fails during pip install
**Solution:**
- Check requirements.txt for version conflicts
- Try removing specific version pins
- Ensure all packages are available for Linux

### **Application Won't Start**
**Problem:** Deployment succeeds but app crashes
**Solution:**
- Check Render logs for error details
- Verify all environment variables are set
- Test MongoDB connection string

### **AI Model Loading Fails**
**Problem:** App starts but crashes when analyzing messages
**Solution:**
- Upgrade to a larger Render plan (more RAM)
- Check internet connectivity for model download
- Verify transformers and torch versions

### **Session File Issues**
**Problem:** Telegram authentication fails
**Solution:**
- Session files are now stored in `/tmp` (works on Render)
- Clear any old local session files
- Re-authenticate if needed

---

## üìä **Monitor Your Deployment**

### **Render Dashboard Features:**
- **Logs:** Real-time application logs
- **Metrics:** CPU, memory, and response time monitoring
- **Events:** Deployment history and status
- **Settings:** Environment variables and configuration

### **Application Monitoring:**
- **Health Endpoint:** `https://your-app.onrender.com/health`
- **User Dashboard:** Full functionality available
- **Database:** Monitor via MongoDB Atlas dashboard

---

## üéØ **Production Optimization**

### **Performance Tips:**
1. **Upgrade Plan:** Consider Render's paid plans for better performance
2. **Database Optimization:** Use MongoDB Atlas's performance insights
3. **Caching:** Implement Redis if needed for session storage
4. **CDN:** Use Cloudflare for static assets

### **Security Recommendations:**
1. **Environment Variables:** Never commit secrets to git
2. **HTTPS:** Render provides automatic SSL certificates
3. **Access Control:** Implement IP whitelisting if needed
4. **Regular Updates:** Keep dependencies updated

---

## üìû **Support and Maintenance**

### **Render Support:**
- Documentation: [render.com/docs](https://render.com/docs)
- Community Forum: [community.render.com](https://community.render.com)
- Status Page: [status.render.com](https://status.render.com)

### **Application Logs:**
```bash
# Access logs via Render dashboard or CLI
render logs --service=telegram-drug-monitor --follow
```

---

## üéâ **Deployment Complete!**

Your **Telegram Drug Monitor** is now live on Render! 

### **Your Application URL:**
`https://telegram-drug-monitor-[random].onrender.com`

### **Admin Access:**
- Register new accounts through the web interface
- Link Telegram accounts for monitoring
- Add channels and start drug detection analysis

### **For Law Enforcement:**
- Professional-grade drug detection system
- Real-time monitoring and alerts
- CSV export for evidence and reports
- Secure multi-user access

---

## üîÑ **Automatic Updates**

Your app will automatically redeploy when you push changes to GitHub:

```bash
# Make changes to your code
git add .
git commit -m "Updated drug detection algorithm"
git push origin main
# Render automatically redeploys!
```

---

**üèÜ Your Telegram Drug Monitor is now running in the cloud, ready for professional law enforcement use!**

## üì± **Next Steps**
1. Share your Render URL with authorized users
2. Monitor the application performance
3. Scale up resources as needed
4. Regular updates and maintenance
